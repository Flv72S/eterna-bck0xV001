"use strict";(()=>{var e={};e.id=231,e.ids=[231],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5900:e=>{e.exports=require("pg")},7612:e=>{e.exports=import("drizzle-orm")},1749:e=>{e.exports=import("drizzle-orm/node-postgres")},8358:e=>{e.exports=import("drizzle-orm/pg-core")},7673:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},9055:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>d,default:()=>c,routeModule:()=>u});var o=a(6205),i=a(4626),n=a(7673),l=a(5738),s=e([l]);l=(s.then?(await s)():s)[0];let c=(0,n.l)(l,"default"),d=(0,n.l)(l,"config"),u=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/register/professionista",pathname:"/api/register/professionista",bundlePath:"",filename:""},userland:l});r()}catch(e){r(e)}})},4798:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{db:()=>c});var o=a(1749),i=a(5900),n=a(7136),l=e([o,n]);[o,n]=l.then?(await l)():l;let s=new i.Pool({connectionString:process.env.DATABASE_URL}),c=(0,o.drizzle)(s,{schema:n});r()}catch(e){r(e)}})},7136:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{pet_medical_records:()=>d,pets:()=>c,tokens:()=>s,users:()=>n,usersPro:()=>l});var o=a(8358),i=e([o]);o=(i.then?(await i)():i)[0];let n=(0,o.pgTable)("users",{id:(0,o.uuid)("id").defaultRandom().primaryKey(),email:(0,o.varchar)("email",{length:255}).notNull().unique(),pin:(0,o.text)("pin").notNull(),token:(0,o.text)("token"),version:(0,o.varchar)("version",{length:20}).default("free"),seriale_gioiello:(0,o.varchar)("seriale_gioiello",{length:100}),nome:(0,o.varchar)("nome",{length:100}),cognome:(0,o.varchar)("cognome",{length:100}),ruolo:(0,o.varchar)("ruolo",{length:30}).default("utente"),attivatore_validato:(0,o.boolean)("attivatore_validato").default(!1),nfc_supportato:(0,o.boolean)("nfc_supportato").default(!0),registrazione_via_nfc:(0,o.boolean)("registrazione_via_nfc").default(!1),otp:(0,o.varchar)("otp",{length:10}),otp_scadenza:(0,o.timestamp)("otp_scadenza"),verificato_email:(0,o.boolean)("verificato_email").default(!1),verificato_telefono:(0,o.boolean)("verificato_telefono").default(!1),ultima_login:(0,o.timestamp)("ultima_login").defaultNow(),created_at:(0,o.timestamp)("created_at").defaultNow(),updated_at:(0,o.timestamp)("updated_at").defaultNow()}),l=(0,o.pgTable)("users_pro",{user_id:(0,o.uuid)("user_id").primaryKey().references(()=>n.id),nome:(0,o.varchar)("nome",{length:100}).notNull(),cognome:(0,o.varchar)("cognome",{length:100}).notNull(),profession_type:(0,o.varchar)("profession_type",{length:100}).notNull(),specialization:(0,o.varchar)("specialization",{length:150}),business_name:(0,o.varchar)("business_name",{length:255}),vat_number:(0,o.varchar)("vat_number",{length:50}),address:(0,o.varchar)("address",{length:255}),city:(0,o.varchar)("city",{length:100}),region:(0,o.varchar)("region",{length:100}),cap:(0,o.varchar)("cap",{length:20}),website:(0,o.varchar)("website",{length:255}),license_number:(0,o.varchar)("license_number",{length:100}),license_country:(0,o.varchar)("license_country",{length:100}),license_verified:(0,o.boolean)("license_verified").default(!1),profile_image_url:(0,o.text)("profile_image_url"),approved_by_admin:(0,o.boolean)("approved_by_admin").default(!1),eterna_section:(0,o.varchar)("eterna_section",{length:100})}),s=(0,o.pgTable)("tokens",{id:(0,o.serial)("id").primaryKey(),user_id:(0,o.serial)("user_id").references(()=>n.id),token:(0,o.varchar)("token",{length:255}).notNull(),type:(0,o.varchar)("type",{length:50}).notNull(),expires_at:(0,o.timestamp)("expires_at").notNull(),created_at:(0,o.timestamp)("created_at").defaultNow().notNull()}),c=(0,o.pgTable)("pets",{id:(0,o.serial)("id").primaryKey(),user_id:(0,o.serial)("user_id").references(()=>n.id),name:(0,o.varchar)("name",{length:255}).notNull(),type:(0,o.varchar)("type",{length:50}).notNull(),breed:(0,o.varchar)("breed",{length:255}),birth_date:(0,o.timestamp)("birth_date"),created_at:(0,o.timestamp)("created_at").defaultNow().notNull(),updated_at:(0,o.timestamp)("updated_at").defaultNow().notNull()}),d=(0,o.pgTable)("pet_medical_records",{id:(0,o.serial)("id").primaryKey(),pet_id:(0,o.serial)("pet_id").references(()=>c.id),record_type:(0,o.varchar)("record_type",{length:50}).notNull(),description:(0,o.text)("description"),date:(0,o.timestamp)("date").notNull(),created_at:(0,o.timestamp)("created_at").defaultNow().notNull()});r()}catch(e){r(e)}})},5738:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>s});var o=a(4798),i=a(7136),n=a(7612),l=e([o,i,n]);async function s(e,t){if(console.log("Richiesta ricevuta:",e.method,e.url),"POST"!==e.method)return console.log("Metodo non consentito:",e.method),t.status(405).json({message:"Method not allowed"});try{console.log("Corpo della richiesta:",e.body);let{email:a,pin:r,nome:l,cognome:s,phone:c,profession_type:d,specialization:u,business_name:p,vat_number:m,address:_,city:g,region:h,cap:f,website:v,license_number:b,license_country:y,eterna_section:P}=e.body;if(!a||!r||!l||!s||!c||!d||!b||!y)return console.log("Campi obbligatori mancanti:",{email:!!a,pin:!!r,nome:!!l,cognome:!!s,phone:!!c,profession_type:!!d,license_number:!!b,license_country:!!y}),t.status(400).json({message:"Campi obbligatori mancanti",required:["email","pin","nome","cognome","phone","profession_type","license_number","license_country"]});if(console.log("Verifica email esistente:",a),(await o.db.select().from(i.users).where((0,n.eq)(i.users.email,a))).length>0)return console.log("Email gi\xe0 registrata:",a),t.status(400).json({message:"Email gi\xe0 registrata"});console.log("Creazione nuovo utente");let[N]=await o.db.insert(i.users).values({email:a,pin:r,nome:l,cognome:s,ruolo:"professionista",verificato_telefono:!1,verificato_email:!1}).returning();return console.log("Utente creato:",N),console.log("Creazione profilo professionista"),await o.db.insert(i.usersPro).values({user_id:N.id,nome:l,cognome:s,profession_type:d,specialization:u,business_name:p,vat_number:m,address:_,city:g,region:h,cap:f,website:v,license_number:b,license_country:y,license_verified:!1,approved_by_admin:!1,eterna_section:P}),console.log("Registrazione completata con successo"),t.status(201).json({message:"Registrazione professionista completata con successo",user_id:N.id,next_steps:["Verifica la tua email cliccando sul link che ti abbiamo inviato","Verifica il tuo numero di telefono inserendo il codice OTP che riceverai via SMS","Attendi l'approvazione del tuo profilo da parte dell'amministratore"]})}catch(e){return console.error("Errore nella registrazione professionista:",e),t.status(500).json({message:"Errore interno del server",error:e instanceof Error?e.message:"Errore sconosciuto"})}}[o,i,n]=l.then?(await l)():l,r()}catch(e){r(e)}})},4626:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},6205:(e,t,a)=>{e.exports=a(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=9055);module.exports=a})();