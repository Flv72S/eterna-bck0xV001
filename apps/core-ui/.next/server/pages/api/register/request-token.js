"use strict";(()=>{var e={};e.id=418,e.ids=[418],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5900:e=>{e.exports=require("pg")},1749:e=>{e.exports=import("drizzle-orm/node-postgres")},8358:e=>{e.exports=import("drizzle-orm/pg-core")},7673:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},3484:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>u,default:()=>d,routeModule:()=>c});var n=a(6205),i=a(4626),o=a(7673),l=a(1614),s=e([l]);l=(s.then?(await s)():s)[0];let d=(0,o.l)(l,"default"),u=(0,o.l)(l,"config"),c=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/register/request-token",pathname:"/api/register/request-token",bundlePath:"",filename:""},userland:l});r()}catch(e){r(e)}})},4798:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{db:()=>d});var n=a(1749),i=a(5900),o=a(7136),l=e([n,o]);[n,o]=l.then?(await l)():l;let s=new i.Pool({connectionString:process.env.DATABASE_URL}),d=(0,n.drizzle)(s,{schema:o});r()}catch(e){r(e)}})},7136:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{pet_medical_records:()=>u,pets:()=>d,tokens:()=>s,users:()=>o,usersPro:()=>l});var n=a(8358),i=e([n]);n=(i.then?(await i)():i)[0];let o=(0,n.pgTable)("users",{id:(0,n.uuid)("id").defaultRandom().primaryKey(),email:(0,n.varchar)("email",{length:255}).notNull().unique(),pin:(0,n.text)("pin").notNull(),token:(0,n.text)("token"),version:(0,n.varchar)("version",{length:20}).default("free"),seriale_gioiello:(0,n.varchar)("seriale_gioiello",{length:100}),nome:(0,n.varchar)("nome",{length:100}),cognome:(0,n.varchar)("cognome",{length:100}),ruolo:(0,n.varchar)("ruolo",{length:30}).default("utente"),attivatore_validato:(0,n.boolean)("attivatore_validato").default(!1),nfc_supportato:(0,n.boolean)("nfc_supportato").default(!0),registrazione_via_nfc:(0,n.boolean)("registrazione_via_nfc").default(!1),otp:(0,n.varchar)("otp",{length:10}),otp_scadenza:(0,n.timestamp)("otp_scadenza"),verificato_email:(0,n.boolean)("verificato_email").default(!1),verificato_telefono:(0,n.boolean)("verificato_telefono").default(!1),ultima_login:(0,n.timestamp)("ultima_login").defaultNow(),created_at:(0,n.timestamp)("created_at").defaultNow(),updated_at:(0,n.timestamp)("updated_at").defaultNow()}),l=(0,n.pgTable)("users_pro",{user_id:(0,n.uuid)("user_id").primaryKey().references(()=>o.id),nome:(0,n.varchar)("nome",{length:100}).notNull(),cognome:(0,n.varchar)("cognome",{length:100}).notNull(),profession_type:(0,n.varchar)("profession_type",{length:100}).notNull(),specialization:(0,n.varchar)("specialization",{length:150}),business_name:(0,n.varchar)("business_name",{length:255}),vat_number:(0,n.varchar)("vat_number",{length:50}),address:(0,n.varchar)("address",{length:255}),city:(0,n.varchar)("city",{length:100}),region:(0,n.varchar)("region",{length:100}),cap:(0,n.varchar)("cap",{length:20}),website:(0,n.varchar)("website",{length:255}),license_number:(0,n.varchar)("license_number",{length:100}),license_country:(0,n.varchar)("license_country",{length:100}),license_verified:(0,n.boolean)("license_verified").default(!1),profile_image_url:(0,n.text)("profile_image_url"),approved_by_admin:(0,n.boolean)("approved_by_admin").default(!1),eterna_section:(0,n.varchar)("eterna_section",{length:100})}),s=(0,n.pgTable)("tokens",{id:(0,n.serial)("id").primaryKey(),user_id:(0,n.serial)("user_id").references(()=>o.id),token:(0,n.varchar)("token",{length:255}).notNull(),type:(0,n.varchar)("type",{length:50}).notNull(),expires_at:(0,n.timestamp)("expires_at").notNull(),created_at:(0,n.timestamp)("created_at").defaultNow().notNull()}),d=(0,n.pgTable)("pets",{id:(0,n.serial)("id").primaryKey(),user_id:(0,n.serial)("user_id").references(()=>o.id),name:(0,n.varchar)("name",{length:255}).notNull(),type:(0,n.varchar)("type",{length:50}).notNull(),breed:(0,n.varchar)("breed",{length:255}),birth_date:(0,n.timestamp)("birth_date"),created_at:(0,n.timestamp)("created_at").defaultNow().notNull(),updated_at:(0,n.timestamp)("updated_at").defaultNow().notNull()}),u=(0,n.pgTable)("pet_medical_records",{id:(0,n.serial)("id").primaryKey(),pet_id:(0,n.serial)("pet_id").references(()=>d.id),record_type:(0,n.varchar)("record_type",{length:50}).notNull(),description:(0,n.text)("description"),date:(0,n.timestamp)("date").notNull(),created_at:(0,n.timestamp)("created_at").defaultNow().notNull()});r()}catch(e){r(e)}})},1614:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>l});var n=a(4798),i=a(7136),o=e([n,i]);async function l(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let{email:a}=e.body;if(!a)return t.status(400).json({message:"Email is required"});let r=Math.random().toString(36).substring(2,15);return await n.db.insert(i.tokens).values({token:r,type:"registration",expires_at:new Date(Date.now()+864e5)}),t.status(200).json({token:r})}catch(e){return console.error("Error generating token:",e),t.status(500).json({message:"Internal server error"})}}[n,i]=o.then?(await o)():o,r()}catch(e){r(e)}})},4626:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},6205:(e,t,a)=>{e.exports=a(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=3484);module.exports=a})();